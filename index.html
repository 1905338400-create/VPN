<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é©¬æœ¯æ•™ç»ƒå‡è„‚è®¡åˆ’</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #007AFF; /* iOS Blue */
            --accent: #FF9500; /* iOS Orange */
            --success: #34C759; /* iOS Green */
            --danger: #FF3B30; /* iOS Red */
            --bg: #F2F2F7;
            --card-bg: #FFFFFF;
            --text-main: #000000;
            --text-sub: #8E8E93;
            --radius: 20px;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* é¡µé¢å®¹å™¨ */
        .page-container { flex: 1; position: relative; overflow: hidden; }
        .page { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 80px) 20px;
            overflow-y: auto; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, transform 0.3s ease;
            transform: scale(0.98);
        }
        .page.active { opacity: 1; visibility: visible; transform: scale(1); z-index: 1; }

        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card { background: var(--card-bg); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 18px; font-weight: 700; }
        .card-subtitle { font-size: 14px; color: var(--text-sub); }

        /* é¦–é¡µ - è¿›åº¦æ¡ */
        .progress-container { margin-top: 10px; }
        .progress-bar-bg { height: 12px; background: #E5E5EA; border-radius: 6px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 1s ease; }
        .progress-text { display: flex; justify-content: space-between; margin-top: 8px; font-size: 14px; font-weight: 600; }

        /* é¦–é¡µ - åœ†ç¯å›¾å¸ƒå±€ */
        .rings-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ring-card { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .ring-wrapper { position: relative; width: 100px; height: 100px; margin-bottom: 10px; }
        .ring-text-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; font-weight: 800; color: var(--text-main); }
        .ring-label { font-size: 12px; color: var(--text-sub); margin-top: 5px; }
        
        svg.ring { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle.ring-bg { fill: none; stroke: #E5E5EA; stroke-width: 8; }
        circle.ring-val { fill: none; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 251; stroke-dashoffset: 251; transition: stroke-dashoffset 1s ease; }

        /* è®­ç»ƒé¡µ */
        .day-scroller { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; margin-bottom: 10px; }
        .day-chip { flex: 0 0 auto; padding: 10px 18px; background: #fff; border-radius: 20px; font-size: 14px; color: var(--text-sub); border: 1px solid transparent; transition: all 0.2s; }
        .day-chip.active { background: var(--primary); color: #fff; box-shadow: 0 4px 8px rgba(0,122,255,0.3); }
        .day-chip.rest { border-color: var(--success); color: var(--success); }
        .day-chip.heavy { border-color: var(--danger); color: var(--danger); }

        .training-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .training-info h4 { font-size: 16px; margin-bottom: 4px; }
        .training-info p { font-size: 12px; color: var(--text-sub); }
        .check-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #E5E5EA; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .check-btn.checked { background: var(--success); border-color: var(--success); color: #fff; }

        /* é¥®é£Ÿé¡µ */
        .food-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .food-btn { background: #fff; padding: 15px; border-radius: 16px; text-align: left; box-shadow: 0 2px 6px rgba(0,0,0,0.03); border: 1px solid #f0f0f0; active: scale(0.95); transition: transform 0.1s; }
        .food-btn h4 { font-size: 15px; margin-bottom: 5px; }
        .food-btn span { font-size: 12px; color: var(--text-sub); display: block; }
        .food-icon { font-size: 24px; margin-bottom: 8px; display: block; }

        /* åº•éƒ¨å¯¼èˆª */
        .tab-bar { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            height: calc(60px + var(--safe-bottom)); 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); 
            border-top: 1px solid rgba(0,0,0,0.1); display: flex; justify-content: space-around; 
            padding-bottom: var(--safe-bottom); z-index: 100;
        }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-sub); font-size: 10px; cursor: pointer; }
        .tab-item.active { color: var(--primary); }
        .tab-icon { font-size: 24px; margin-bottom: 4px; }

        /* å¼¹çª— */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: none; justify-content: center; align-items: flex-end; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: #fff; width: 100%; border-radius: 24px 24px 0 0; padding: 30px 20px calc(20px + var(--safe-bottom)) 20px; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .btn-primary { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 14px; font-size: 16px; font-weight: 600; margin-top: 15px; }

    </style>
</head>
<body>

    <div class="page-container">
        <div id="home" class="page active">
            <h1 style="margin-bottom: 20px;">ä½ å¥½ï¼Œæ•™ç»ƒ ğŸ’ª</h1>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">å‡é‡ç›®æ ‡</span>
                    <span class="card-subtitle">ç›®æ ‡: -10kg</span>
                </div>
                <h2 id="currentWeightDisplay" style="font-size: 32px; font-weight: 800;">85.0 <span style="font-size:16px; color:#8E8E93;">kg</span></h2>
                <div class="progress-container">
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="weightProgress" style="width: 0%;"></div>
                    </div>
                    <div class="progress-text">
                        <span>åˆå§‹: 85kg</span>
                        <span>ç›®æ ‡: 75kg</span>
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: center; color: var(--primary); font-size: 14px; font-weight: 600;" onclick="openWeightModal()">
                    + è®°å½•ä»Šæ—¥ä½“é‡
                </div>
            </div>

            <div class="rings-row">
                <div class="card ring-card">
                    <div class="ring-wrapper">
                        <svg class="ring">
                            <circle class="ring-bg" cx="50" cy="50" r="40"></circle>
                            <circle class="ring-val" id="burnCircle" cx="50" cy="50" r="40" stroke="#FF9500"></circle>
                        </svg>
                        <div class="ring-text-center" id="burnPercent">0%</div>
                    </div>
                    <div class="card-title" style="font-size:16px;">ä»Šæ—¥æ¶ˆè€—</div>
                    <div class="ring-label" id="burnText">å¾…å®Œæˆè®¡åˆ’</div>
                </div>
                <div class="card ring-card">
                    <div class="ring-wrapper">
                        <svg class="ring">
                            <circle class="ring-bg" cx="50" cy="50" r="40"></circle>
                            <circle class="ring-val" id="eatCircle" cx="50" cy="50" r="40" stroke="#34C759"></circle>
                        </svg>
                        <div class="ring-text-center" id="eatCal">0</div>
                    </div>
                    <div class="card-title" style="font-size:16px;">ä»Šæ—¥æ‘„å…¥</div>
                    <div class="ring-label" id="eatRemain" style="color:var(--success)">è¿˜èƒ½åƒ: 1500</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">è¿‘10å¤©ä½“é‡è¶‹åŠ¿</span>
                </div>
                <canvas id="weightChart" height="200"></canvas>
            </div>
        </div>

        <div id="train" class="page">
            <h1 style="margin-bottom: 20px;">è®­ç»ƒè®¡åˆ’ ğŸ</h1>
            
            <div class="day-scroller">
                <div class="day-chip heavy" onclick="selectDay(0)">å‘¨ä¸€ (å†²åˆº)</div>
                <div class="day-chip rest" onclick="selectDay(1)">å‘¨äºŒ (ä¼‘æ¯)</div>
                <div class="day-chip" onclick="selectDay(2)">å‘¨ä¸‰</div>
                <div class="day-chip" onclick="selectDay(3)">å‘¨å››</div>
                <div class="day-chip" onclick="selectDay(4)">å‘¨äº”</div>
                <div class="day-chip heavy" onclick="selectDay(5)">å‘¨å…­ (å·¥ä½œ)</div>
                <div class="day-chip heavy" onclick="selectDay(6)">å‘¨æ—¥ (å·¥ä½œ)</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title" id="todayPlanTitle">ä»Šæ—¥ä»»åŠ¡</span>
                    <span class="card-subtitle" id="workLoadBadge">å·¥ä½œå¼ºåº¦: ä¸­</span>
                </div>
                <div id="trainingList">
                    </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">é¢å¤–è¿åŠ¨æ‰“å¡</h3>
            <div class="food-grid">
                <div class="food-btn" onclick="logExercise('running')">
                    <span class="food-icon">ğŸƒâ€â™‚ï¸</span>
                    <h4>è·‘æ­¥ (æœ‰æ°§)</h4>
                    <span>ç‚¹å‡»è¾“å…¥å…¬é‡Œæ•°</span>
                </div>
                <div class="food-btn" onclick="logExercise('dumbbell')">
                    <span class="food-icon">ğŸ‹ï¸</span>
                    <h4>æ— æ°§åŠ ç»ƒ</h4>
                    <span>å“‘é“ƒ/æ ¸å¿ƒ 40åˆ†é’Ÿ</span>
                </div>
            </div>
        </div>

        <div id="diet" class="page">
            <h1 style="margin-bottom: 20px;">çƒ­é‡ç¼ºå£ ğŸ¥—</h1>
            
            <div class="card" style="background: var(--primary); color: white;">
                <div class="card-header">
                    <span class="card-title" style="color:white">ä»Šæ—¥å‰©ä½™é¢åº¦</span>
                </div>
                <h2 id="dietRemainBig" style="font-size: 36px;">1800 <span style="font-size:18px">kcal</span></h2>
                <p id="dietAdvice" style="font-size: 13px; opacity: 0.9; margin-top:5px;">è¿˜å¯ä»¥åƒé¡¿å¥½çš„ï¼Œè®°å¾—å¤šåƒè‚‰ï¼</p>
            </div>

            <h3 style="margin-bottom: 10px;">å¿«é€Ÿæ‰“å¡</h3>
            
            <p style="color:var(--text-sub); font-size:12px; margin-bottom:10px;">ä¸»é£Ÿç±» (1æ‹³å¤´ â‰ˆ 100g-150g)</p>
            <div class="food-grid">
                <div class="food-btn" onclick="addFood('ç±³é¥­', 180)">
                    <span class="food-icon">ğŸš</span>
                    <h4>ç±³é¥­</h4>
                    <span>1æ‹³å¤´ (150g)</span>
                </div>
                <div class="food-btn" onclick="addFood('é¢æ¡', 160)">
                    <span class="food-icon">ğŸœ</span>
                    <h4>é¢æ¡</h4>
                    <span>1å°ç¢— (150g)</span>
                </div>
                <div class="food-btn" onclick="addFood('é¦’å¤´', 220)">
                    <span class="food-icon">ğŸ¥¯</span>
                    <h4>é¦’å¤´</h4>
                    <span>1ä¸ª (100g)</span>
                </div>
                <div class="food-btn" onclick="addFood('ç‰ç±³', 110)">
                    <span class="food-icon">ğŸŒ½</span>
                    <h4>ç‰ç±³</h4>
                    <span>1æ ¹ (200g)</span>
                </div>
            </div>

            <p style="color:var(--text-sub); font-size:12px; margin:20px 0 10px 0;">è›‹ç™½è´¨ (1æ‰‹æŒå¿ƒ â‰ˆ 100g)</p>
            <div class="food-grid">
                <div class="food-btn" onclick="addFood('ç‰›è‚‰', 150)">
                    <span class="food-icon">ğŸ¥©</span>
                    <h4>ç‰›è‚‰</h4>
                    <span>1æ‰‹æŒå¿ƒ (100g)</span>
                </div>
                <div class="food-btn" onclick="addFood('é¸¡èƒ¸è‚‰', 130)">
                    <span class="food-icon">ğŸ—</span>
                    <h4>é¸¡èƒ¸è‚‰</h4>
                    <span>1æ‰‹æŒå¿ƒ (100g)</span>
                </div>
                <div class="food-btn" onclick="addFood('é¸¡è›‹', 70)">
                    <span class="food-icon">ğŸ¥š</span>
                    <h4>é¸¡è›‹</h4>
                    <span>1ä¸ª (50g)</span>
                </div>
                <div class="food-btn" onclick="addFood('ç‰›å¥¶', 140)">
                    <span class="food-icon">ğŸ¥›</span>
                    <h4>ç‰›å¥¶</h4>
                    <span>1ç›’ (250ml)</span>
                </div>
            </div>
            
            <div style="height: 100px;"></div> </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <span class="tab-icon">ğŸ“Š</span>
            <span>è¿›åº¦</span>
        </div>
        <div class="tab-item" onclick="switchTab('train')">
            <span class="tab-icon">ğŸ‹ï¸</span>
            <span>è®­ç»ƒ</span>
        </div>
        <div class="tab-item" onclick="switchTab('diet')">
            <span class="tab-icon">ğŸ½ï¸</span>
            <span>ç¼ºå£</span>
        </div>
    </div>

    <div class="modal-overlay" id="weightModal">
        <div class="modal-content">
            <h3>å½•å…¥ä»Šæ—¥ä½“é‡</h3>
            <input type="number" id="newWeightInput" placeholder="85.0" style="width:100%; padding:15px; font-size:24px; border:1px solid #ddd; border-radius:12px; margin-top:10px;">
            <button class="btn-primary" onclick="saveWeight()">ä¿å­˜</button>
            <button class="btn-primary" style="background:#f0f0f0; color:#333; margin-top:10px;" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒæ•°æ®çŠ¶æ€ ---
        const state = {
            currentWeight: 85.0,
            targetWeight: 75.0,
            startWeight: 85.0,
            caloriesConsumed: 0,
            caloriesBurned: 0, // è¿åŠ¨æ¶ˆè€—
            baseMetabolism: 1800, // åŸºç¡€ä»£è°¢ + æ—¥å¸¸å·¥ä½œä¼°ç®—
            maxCalories: 1900, // ç›®æ ‡æ‘„å…¥
            history: [85.5, 85.3, 85.2, 85.0, 84.8, 85.1, 84.9, 84.7, 84.8, 85.0], // æ¨¡æ‹Ÿ10å¤©æ•°æ®
            today: new Date().getDay() // 0-6 (å‘¨æ—¥-å‘¨å…­)
        };

        // å‘¨ä¸€åˆ°å‘¨æ—¥çš„è®­ç»ƒè®¡åˆ’é…ç½®
        const weeklyPlan = [
            { name: "å‘¨æ—¥ (å·¥ä½œæ—¥)", tasks: [{n:"é©¬æˆ¿å·¥ä½œ", cal:600}, {n:"æ‹‰ä¼¸", cal:50}], type:"work" }, // 0
            { name: "å‘¨ä¸€ (å†²åˆºæ—¥)", tasks: [{n:"å“‘é“ƒå¾ªç¯x4", cal:300}, {n:"è·‘æ­¥30åˆ†", cal:300}], type:"heavy" }, // 1
            { name: "å‘¨äºŒ (ä¼‘æ¯æ—¥)", tasks: [{n:"å…¨èº«æ‹‰ä¼¸", cal:50}], type:"rest" }, // 2
            { name: "å‘¨ä¸‰ (å¡‘å½¢æ—¥)", tasks: [{n:"ä¸Šè‚¢å“‘é“ƒ", cal:250}, {n:"å¹³æ¿æ”¯æ’‘", cal:50}], type:"normal" }, // 3
            { name: "å‘¨å›› (ä¿ƒç¾æ—¥)", tasks: [{n:"ä¸‹è‚¢æ·±è¹²", cal:300}, {n:"å·è…¹", cal:50}], type:"normal" }, // 4
            { name: "å‘¨äº” (å…¨èº«æ—¥)", tasks: [{n:"å“‘é“ƒå¾ªç¯x4", cal:300}], type:"normal" }, // 5
            { name: "å‘¨å…­ (å·¥ä½œæ—¥)", tasks: [{n:"é©¬æœ¯æ•™å­¦", cal:700}], type:"work" }  // 6
        ];

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            updateUI();
            
            // é»˜è®¤é€‰ä¸­ä»Šå¤©
            let dayIndex = state.today; 
            selectDay(dayIndex === 0 ? 6 : dayIndex - 1); // è°ƒæ•´JS 0=å‘¨æ—¥ ä¸º UI ä¹ æƒ¯
            
            // è‡ªåŠ¨åŠ ä¸ŠåŸºç¡€ä»£è°¢
            // å®é™…å¼€å‘ä¸­åº”è¯¥æ¯å¤©é‡ç½®ï¼Œè¿™é‡Œæ¨¡æ‹Ÿ
        });

        // --- UI æ›´æ–°é€»è¾‘ ---
        function updateUI() {
            // 1. ä½“é‡è¿›åº¦
            document.getElementById('currentWeightDisplay').innerHTML = `${state.currentWeight} <span style="font-size:16px; color:#8E8E93;">kg</span>`;
            const lost = state.startWeight - state.currentWeight;
            const total = state.startWeight - state.targetWeight;
            const percent = Math.min(100, Math.max(0, (lost / total) * 100));
            document.getElementById('weightProgress').style.width = `${percent}%`;

            // 2. æ‘„å…¥åœ†ç¯ (å€’åºåœ†ç¯ï¼šåƒå¾—è¶Šå¤šï¼Œåœˆè¶ŠçŸ­æˆ–å˜è‰²)
            document.getElementById('eatCal').innerText = state.caloriesConsumed;
            const remain = state.maxCalories - state.caloriesConsumed;
            const eatEl = document.getElementById('eatRemain');
            const eatCircle = document.getElementById('eatCircle');
            
            eatEl.innerText = remain > 0 ? `è¿˜èƒ½åƒ: ${remain}` : `å·²è¶…æ ‡: ${Math.abs(remain)}`;
            eatEl.style.color = remain > 0 ? 'var(--success)' : 'var(--danger)';
            eatCircle.style.stroke = remain > 0 ? '#34C759' : '#FF3B30';
            
            // ç®€å•çš„åœ†ç¯è¿›åº¦è®¡ç®— (251æ˜¯å‘¨é•¿)
            const eatOffset = 251 - (Math.min(state.caloriesConsumed, state.maxCalories) / state.maxCalories) * 251;
            eatCircle.style.strokeDashoffset = eatOffset;

            // å¤§å­—å±•ç¤º
            document.getElementById('dietRemainBig').innerHTML = `${remain} <span style="font-size:18px">kcal</span>`;
            if(remain < 200) document.getElementById('dietAdvice').innerText = "ä½™é¢ä¸è¶³ï¼Œåƒæ ¹é»„ç“œæˆ–è€…ç¡è§‰å§ï¼";

            // 3. æ¶ˆè€—åœ†ç¯
            // å‡è®¾ä»Šæ—¥ç›®æ ‡æ¶ˆè€— = åŸºç¡€(1800) + è®¡åˆ’è®­ç»ƒ
            const todayPlanCal = weeklyPlan[state.today].tasks.reduce((a,b)=>a+b.cal, 0);
            const totalTargetBurn = state.baseMetabolism + todayPlanCal;
            const currentTotalBurn = state.baseMetabolism + state.caloriesBurned; // åŸºç¡€ + å·²å®Œæˆæ‰“å¡
            
            const burnPercent = Math.round((currentTotalBurn / totalTargetBurn) * 100);
            document.getElementById('burnPercent').innerText = `${burnPercent}%`;
            document.getElementById('burnCircle').style.strokeDashoffset = 251 - (Math.min(100, burnPercent)/100 * 251);
        }

        // --- äº¤äº’é€»è¾‘ ---
        function switchTab(tabId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // ç®€å•åŒ¹é…Tabé«˜äº®
            const index = tabId === 'home' ? 0 : tabId === 'train' ? 1 : 2;
            document.querySelectorAll('.tab-item')[index].classList.add('active');
        }

        function selectDay(dayIdx) {
            // è¿™é‡Œçš„dayIdx: 0=å‘¨ä¸€ ... 6=å‘¨æ—¥ (ä¸ºäº†é…åˆUIæ’åˆ—)
            // è½¬æ¢å› JS Date Day (0=Sun, 1=Mon)
            const realDay = dayIdx === 6 ? 0 : dayIdx + 1;
            
            document.querySelectorAll('.day-chip').forEach((c, i) => {
                c.classList.toggle('active', i === dayIdx);
            });

            const plan = weeklyPlan[realDay];
            document.getElementById('todayPlanTitle').innerText = `${plan.name} ä»»åŠ¡`;
            
            const list = document.getElementById('trainingList');
            list.innerHTML = '';
            
            plan.tasks.forEach(task => {
                list.innerHTML += `
                <div class="training-item">
                    <div class="training-info">
                        <h4>${task.n}</h4>
                        <p>é¢„è®¡æ¶ˆè€—: ${task.cal} kcal</p>
                    </div>
                    <div class="check-btn" onclick="toggleTask(this, ${task.cal})">âœ“</div>
                </div>`;
            });
        }

        function toggleTask(btn, cal) {
            if(btn.classList.contains('checked')) {
                btn.classList.remove('checked');
                state.caloriesBurned -= cal;
            } else {
                btn.classList.add('checked');
                state.caloriesBurned += cal;
            }
            updateUI();
        }

        function addFood(name, cal) {
            state.caloriesConsumed += cal;
            updateUI();
            // ç®€å•åé¦ˆ
            alert(`å·²è®°å½•: ${name} (+${cal} kcal)`);
        }
        
        function logExercise(type) {
            let cal = 0;
            if(type === 'running') {
                const km = prompt("è·‘äº†å¤šå°‘å…¬é‡Œï¼Ÿ");
                if(km) cal = km * 60; // ç²—ç•¥ä¼°ç®—
            } else {
                cal = 200; // æ— æ°§ä¼°ç®—
            }
            if(cal > 0) {
                state.caloriesBurned += cal;
                updateUI();
                alert(`è¿åŠ¨æ‰“å¡æˆåŠŸï¼æ¶ˆè€—çº¦ ${cal} kcal`);
            }
        }

        // --- å¼¹çª—ä¸å›¾è¡¨ ---
        function openWeightModal() { document.getElementById('weightModal').classList.add('show'); }
        function closeModal() { document.getElementById('weightModal').classList.remove('show'); }
        function saveWeight() {
            const val = parseFloat(document.getElementById('newWeightInput').value);
            if(val) {
                state.currentWeight = val;
                state.history.push(val);
                state.history.shift(); // ä¿æŒ10ä¸ª
                updateUI();
                initChart(); // åˆ·æ–°å›¾è¡¨
                closeModal();
            }
        }

        function initChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            
            // é”€æ¯æ—§å®ä¾‹é˜²æ­¢é‡å 
            if(window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', 'ä»Šå¤©'],
                    datasets: [{
                        label: 'ä½“é‡ (kg)',
                        data: state.history,
                        borderColor: '#007AFF',
                        backgroundColor: 'rgba(0,122,255,0.1)',
                        borderWidth: 3,
                        pointRadius: 4,
                        tension: 0.4, // å¹³æ»‘æ›²çº¿
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 70, max: 90, grid: { borderDash: [5, 5] } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
    </script>
</body>
</html>