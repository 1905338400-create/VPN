<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>é©¬æœ¯å¡‘å½¢è®¡åˆ’</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #007AFF;
            --accent: #FF9500;
            --success: #34C759;
            --danger: #FF3B30;
            --bg: #F2F2F7;
            --card-bg: #FFFFFF;
            --text-main: #1C1C1E;
            --text-sub: #8E8E93;
            --radius: 20px;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --anim-speed: 0.3s;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, "SF Pro Text", Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* å¸ƒå±€å®¹å™¨ */
        .page-container { flex: 1; position: relative; overflow: hidden; }
        .page { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 90px) 20px;
            overflow-y: auto; opacity: 0; visibility: hidden; 
            transition: opacity 0.2s ease;
            -webkit-overflow-scrolling: touch; /* iOSé¡ºæ»‘æ»šåŠ¨ */
        }
        .page.active { opacity: 1; visibility: visible; z-index: 10; }

        /* å¡ç‰‡é£æ ¼ */
        .card { background: var(--card-bg); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 0.5px solid rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 17px; font-weight: 700; color: var(--text-main); }
        .card-subtitle { font-size: 13px; color: var(--text-sub); }

        /* é¦–é¡µ - è¿›åº¦æ¡ */
        .progress-box { margin-top: 10px; }
        .progress-bg { height: 14px; background: #E5E5EA; border-radius: 7px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007AFF, #5AC8FA); width: 0%; transition: width 1s cubic-bezier(0.2, 0.8, 0.2, 1); border-radius: 7px; }
        .progress-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 13px; font-weight: 600; color: var(--text-sub); }

        /* é¦–é¡µ - åœ†ç¯ */
        .rings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .ring-card { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 20px 10px; }
        .ring-wrapper { position: relative; width: 110px; height: 110px; margin-bottom: 12px; }
        .ring-center-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; }
        .ring-percent { font-size: 24px; font-weight: 800; line-height: 1; }
        .ring-unit { font-size: 11px; color: var(--text-sub); margin-top: 2px; }
        
        .ring-formula-title { font-size: 12px; color: var(--text-sub); margin-bottom: 4px; }
        .ring-formula-val { font-size: 16px; font-weight: 700; color: var(--text-main); }
        .ring-formula-desc { font-size: 10px; color: #C7C7CC; margin-top: 4px; line-height: 1.2; transform: scale(0.9); }

        svg.ring { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .ring-bg-c { stroke: #F2F2F7; }
        .ring-val-c { stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 1s ease; }

        /* é€šç”¨ - æ»‘åŠ¨å›¾è¡¨å®¹å™¨ */
        .chart-scroll-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 10px; }
        .chart-inner { height: 220px; min-width: 100%; position: relative; }

        /* é¡¶éƒ¨æ—¥æœŸé€‰æ‹©æ¡ */
        .date-scroller { display: flex; overflow-x: auto; gap: 12px; padding: 5px 5px 15px 5px; -webkit-overflow-scrolling: touch; }
        .date-chip { 
            flex: 0 0 auto; padding: 8px 16px; background: #fff; border-radius: 18px; 
            font-size: 13px; font-weight: 600; color: var(--text-sub); 
            box-shadow: 0 2px 6px rgba(0,0,0,0.03); border: 1px solid transparent; transition: all 0.2s;
        }
        .date-chip.active { background: var(--text-main); color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .date-chip.today { color: var(--primary); border-color: rgba(0,122,255,0.2); }

        /* ç½®é¡¶é™æ€è®¡åˆ’åˆ—è¡¨ */
        .static-plan-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 0.5px solid #F2F2F7; opacity: 0.9; }
        .static-plan-item:last-child { border-bottom: none; }
        .dot { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; margin-right: 10px; }
        .static-text { font-size: 14px; flex: 1; }
        .static-cal { font-size: 12px; color: var(--text-sub); }
        .done-badge { display: none; background: var(--success); color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;}
        .static-plan-item.done .done-badge { display: inline-block; }
        .static-plan-item.done .static-text { text-decoration: line-through; color: var(--text-sub); }

        /* æ‰‹é£ç´äº¤äº’ (æ‰“å¡åŒº) */
        .accordion-group { display: flex; flex-direction: column; gap: 15px; }
        .accordion-item { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.02); border: 0.5px solid rgba(0,0,0,0.03); transition: all 0.2s; }
        .accordion-header { padding: 18px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: #fff; z-index: 2; position: relative; }
        .accordion-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .accordion-icon { font-size: 20px; }
        .arrow { width: 12px; height: 12px; border-right: 2px solid #C7C7CC; border-bottom: 2px solid #C7C7CC; transform: rotate(45deg); transition: transform 0.3s; }
        
        .accordion-item.expanded .arrow { transform: rotate(-135deg); border-color: var(--primary); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1); background: #FAFAFC; }
        
        .option-grid { display: grid; grid-template-columns: 1fr; padding: 10px 15px 15px 15px; gap: 10px; }
        .option-btn { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; background: #fff; border-radius: 12px; 
            border: 1px solid #E5E5EA; font-size: 14px; color: var(--text-main);
        }
        .option-btn:active { background: #F2F2F7; transform: scale(0.98); }
        .opt-meta { font-size: 12px; color: var(--text-sub); }

        /* å†å²è®°å½•åˆ—è¡¨ */
        .log-list { margin-top: 10px; }
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 0.5px solid #F2F2F7; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .log-info h5 { font-size: 14px; font-weight: 500; margin-bottom: 2px; }
        .log-info span { font-size: 12px; color: var(--text-sub); }
        .del-btn { color: var(--danger); font-size: 12px; padding: 5px 10px; background: rgba(255,59,48,0.1); border-radius: 6px; border: none; }

        /* åº•éƒ¨å¯¼èˆª */
        .tab-bar { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            height: calc(55px + var(--safe-bottom)); 
            background: rgba(255,255,255,0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.1); display: flex; justify-content: space-around; 
            padding-bottom: var(--safe-bottom); z-index: 100;
        }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; font-size: 10px; cursor: pointer; transition: color 0.2s; }
        .tab-item.active { color: var(--primary); }
        .tab-icon { font-size: 24px; margin-bottom: 3px; }

        /* æ•°é‡é€‰æ‹©å¼¹çª— (ç®€å•æ¨¡æ‹Ÿ) */
        .toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 15px 25px; border-radius: 12px; z-index: 200; font-size: 14px; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }

    </style>
</head>
<body>

    <div class="page-container">
        
        <div id="home" class="page active">
            <h1 style="margin-bottom: 15px; font-size: 28px;">ä»ªè¡¨ç›˜ ğŸ“Š</h1>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ä½“é‡è¿›åº¦</span>
                    <span class="card-subtitle">ç›®æ ‡: 75.0kg</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 8px;">
                    <h2 id="currentWeightDisplay" style="font-size: 34px; font-weight: 800;">85.0</h2>
                    <span style="font-size:16px; color:var(--text-sub);">kg</span>
                    <span id="weightDiff" style="font-size: 14px; color: var(--success); margin-left: auto;">åˆå§‹è‡³ä»Š -0.0 kg</span>
                </div>
                <div class="progress-box">
                    <div class="progress-bg"><div class="progress-fill" id="weightProgressBar"></div></div>
                    <div class="progress-labels"><span>85.0kg</span><span>75.0kg</span></div>
                </div>
            </div>

            <div class="rings-grid">
                <div class="card ring-card">
                    <div class="ring-wrapper">
                        <svg class="ring" viewBox="0 0 100 100">
                            <circle class="ring-bg-c" cx="50" cy="50" r="45"></circle>
                            <circle class="ring-val-c" id="burnRing" cx="50" cy="50" r="45" stroke="#FF9500"></circle>
                        </svg>
                        <div class="ring-center-content">
                            <div class="ring-percent" id="burnPercent">0%</div>
                            <div class="ring-unit">kcal</div>
                        </div>
                    </div>
                    <div class="ring-formula-title">è¿˜éœ€æ¶ˆè€—</div>
                    <div class="ring-formula-val" id="burnNeeded">0</div>
                    <div class="ring-formula-desc">(è¿åŠ¨ç›®æ ‡ - å·²è¿åŠ¨)</div>
                </div>

                <div class="card ring-card">
                    <div class="ring-wrapper">
                        <svg class="ring" viewBox="0 0 100 100">
                            <circle class="ring-bg-c" cx="50" cy="50" r="45"></circle>
                            <circle class="ring-val-c" id="eatRing" cx="50" cy="50" r="45" stroke="#34C759"></circle>
                        </svg>
                        <div class="ring-center-content">
                            <div class="ring-percent" id="eatPercent">0%</div>
                            <div class="ring-unit">kcal</div>
                        </div>
                    </div>
                    <div class="ring-formula-title">è¿˜éœ€æ‘„å…¥</div>
                    <div class="ring-formula-val" id="eatRemaining">0</div>
                    <div class="ring-formula-desc">(é™é¢ - å·²æ‘„å…¥)</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">ä½“é‡è¶‹åŠ¿</span>
                    <span class="card-subtitle">è¿‘14å¤©</span>
                </div>
                <div class="chart-scroll-wrapper" id="weightChartWrapper">
                    <div class="chart-inner">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div style="height: 20px;"></div>
        </div>


        <div id="train" class="page">
            <h1 style="margin-bottom: 15px; font-size: 28px;">è®­ç»ƒè®¡åˆ’ ğŸ</h1>

            <div class="date-scroller" id="trainDateScroller">
                </div>

            <div class="card" style="margin-top: 10px;">
                <div class="card-header">
                    <span class="card-title" id="trainPlanTitle">ä»Šæ—¥è®¡åˆ’</span>
                    <span class="card-subtitle" style="font-size: 11px; background:#F2F2F7; padding:4px 8px; border-radius:6px;" id="trainPlanType">å¼ºåº¦: é«˜</span>
                </div>
                <div id="trainPlanList">
                    </div>
            </div>

            <h3 style="margin: 25px 0 15px 0; padding-left: 5px;">è¿åŠ¨æ‰“å¡</h3>
            <div class="accordion-group">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸƒâ€â™‚ï¸</span>æœ‰æ°§è®­ç»ƒ</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addExercise('è·‘æ­¥', 10, 80)">
                                <div><b>è·‘æ­¥</b> <span class="opt-meta">10åˆ†é’Ÿ</span></div>
                                <span class="opt-meta">80 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addExercise('è·‘æ­¥', 20, 160)">
                                <div><b>è·‘æ­¥</b> <span class="opt-meta">20åˆ†é’Ÿ</span></div>
                                <span class="opt-meta">160 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addExercise('è·‘æ­¥', 30, 250)">
                                <div><b>è·‘æ­¥</b> <span class="opt-meta">30åˆ†é’Ÿ</span></div>
                                <span class="opt-meta">250 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸ‹ï¸</span>æ— æ°§/æ ¸å¿ƒ</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addExercise('å“‘é“ƒå¾ªç¯', 1, 150)">
                                <div><b>å“‘é“ƒå¾ªç¯</b> <span class="opt-meta">1ç»„(4åŠ¨ä½œ)</span></div>
                                <span class="opt-meta">150 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addExercise('æ ¸å¿ƒè®­ç»ƒ', 10, 80)">
                                <div><b>æ ¸å¿ƒ/è…¹è‚Œ</b> <span class="opt-meta">10åˆ†é’Ÿ</span></div>
                                <span class="opt-meta">80 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addExercise('é©¬æˆ¿é‡å·¥', 60, 300)">
                                <div><b>é©¬æˆ¿é‡å·¥</b> <span class="opt-meta">1å°æ—¶(é¢å¤–)</span></div>
                                <span class="opt-meta">300 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <span class="card-title">ä»Šæ—¥å·²å®Œæˆ</span>
                </div>
                <div id="exerciseLogList" class="log-list">
                    <p style="text-align:center; color:var(--text-sub); font-size:12px; padding:10px;">æš‚æ— è®°å½•</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">çƒ­é‡æ¶ˆè€—è¶‹åŠ¿</span>
                </div>
                <div class="chart-scroll-wrapper" id="burnChartWrapper">
                    <div class="chart-inner">
                        <canvas id="burnChart"></canvas>
                    </div>
                </div>
            </div>
        </div>


        <div id="diet" class="page">
            <h1 style="margin-bottom: 15px; font-size: 28px;">çƒ­é‡ç¼ºå£ ğŸ¥—</h1>

             <div class="date-scroller" id="dietDateScroller">
                </div>

            <div class="card" style="margin-top: 10px; background: linear-gradient(135deg, #007AFF 0%, #0055B3 100%); color: white; border:none;">
                <div class="card-header" style="color:white;">
                    <span class="card-title" style="color:white;">ä»Šæ—¥æ¨è</span>
                    <span class="card-subtitle" style="color:rgba(255,255,255,0.7);">åŸºäºæ‰‹æŒé¥®é£Ÿæ³•</span>
                </div>
                <div id="dietRecommendList" style="font-size: 14px; line-height: 1.6;">
                    </div>
            </div>

            <h3 style="margin: 25px 0 15px 0; padding-left: 5px;">é¥®é£Ÿæ‰“å¡</h3>
            <div class="accordion-group">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸš</span>ä¸»é£Ÿ (Carbs)</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addFood('ç±³é¥­', 180, '1æ‹³å¤´')">
                                <div><b>ç±³é¥­</b> <span class="opt-meta">1æ‹³å¤´(150g)</span></div>
                                <span class="opt-meta">180 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addFood('é¢æ¡', 160, '1å°ç¢—')">
                                <div><b>é¢æ¡</b> <span class="opt-meta">1å°ç¢—(150g)</span></div>
                                <span class="opt-meta">160 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addFood('ç‰ç±³', 110, '1æ ¹')">
                                <div><b>ç‰ç±³</b> <span class="opt-meta">1æ ¹(200g)</span></div>
                                <span class="opt-meta">110 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸ¥©</span>è›‹ç™½è´¨ (Protein)</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addFood('ç‰›è‚‰', 150, '1æ‰‹æŒ')">
                                <div><b>ç‰›è‚‰</b> <span class="opt-meta">1æ‰‹æŒ(100g)</span></div>
                                <span class="opt-meta">150 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addFood('é¸¡èƒ¸è‚‰', 120, '1æ‰‹æŒ')">
                                <div><b>é¸¡èƒ¸è‚‰</b> <span class="opt-meta">1æ‰‹æŒ(100g)</span></div>
                                <span class="opt-meta">120 kcal</span>
                            </div>
                            <div class="option-btn" onclick="addFood('é¸¡è›‹', 70, '1ä¸ª')">
                                <div><b>é¸¡è›‹</b> <span class="opt-meta">1ä¸ª</span></div>
                                <span class="opt-meta">70 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸ¥¦</span>è”¬èœ (Veggies)</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addFood('ç”Ÿèœ/é»„ç“œ', 20, '1æ§')">
                                <div><b>ç”Ÿèœ/é»„ç“œ</b> <span class="opt-meta">1æ§(ä¸é™é‡)</span></div>
                                <span class="opt-meta">20 kcal</span>
                            </div>
                             <div class="option-btn" onclick="addFood('ç‚’é’èœ', 80, '1ç›˜')">
                                <div><b>ç‚’é’èœ</b> <span class="opt-meta">1ç›˜(å«æ²¹)</span></div>
                                <span class="opt-meta">80 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                 <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="accordion-title"><span class="accordion-icon">ğŸ</span>æ°´æœ (Fruit)</div>
                        <div class="arrow"></div>
                    </div>
                    <div class="accordion-content">
                        <div class="option-grid">
                            <div class="option-btn" onclick="addFood('è‹¹æœ', 50, '1ä¸ª')">
                                <div><b>è‹¹æœ</b> <span class="opt-meta">1ä¸ª(ä¸­)</span></div>
                                <span class="opt-meta">50 kcal</span>
                            </div>
                             <div class="option-btn" onclick="addFood('é¦™è•‰', 90, '1æ ¹')">
                                <div><b>é¦™è•‰</b> <span class="opt-meta">1æ ¹(ä¸­)</span></div>
                                <span class="opt-meta">90 kcal</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <span class="card-title">ä»Šæ—¥å·²æ‘„å…¥</span>
                </div>
                <div id="foodLogList" class="log-list">
                    <p style="text-align:center; color:var(--text-sub); font-size:12px; padding:10px;">æš‚æ— è®°å½•</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">æ‘„å…¥çƒ­é‡è¶‹åŠ¿</span>
                </div>
                <div class="chart-scroll-wrapper" id="intakeChartWrapper">
                    <div class="chart-inner">
                        <canvas id="intakeChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">æ¯æ—¥çƒ­é‡ç¼ºå£</span>
                </div>
                <div class="chart-scroll-wrapper" id="deficitChartWrapper">
                    <div class="chart-inner">
                        <canvas id="deficitChart"></canvas>
                    </div>
                </div>
            </div>
            
        </div>

    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <span class="tab-icon">ğŸ“Š</span>
            <span>è¿›åº¦</span>
        </div>
        <div class="tab-item" onclick="switchTab('train')">
            <span class="tab-icon">ğŸ‹ï¸</span>
            <span>è®­ç»ƒ</span>
        </div>
        <div class="tab-item" onclick="switchTab('diet')">
            <span class="tab-icon">ğŸ½ï¸</span>
            <span>ç¼ºå£</span>
        </div>
    </div>

    <div id="toast" class="toast">è®°å½•æˆåŠŸ</div>

    <script>
        // ============ æ•°æ®é…ç½® ============
        const CONFIG = {
            targetWeight: 75.0,
            startWeight: 85.0,
            baseMetabolism: 1800, // åŸºç¡€ + åŸºç¡€å·¥ä½œ
            dailyTargetIntake: 1900,
            dailyTargetBurn: 500, // é¢å¤–è¿åŠ¨ç›®æ ‡
        };

        // æ¨¡æ‹Ÿæ•°æ®åº“
        const state = {
            todayIndex: new Date().getDay() === 0 ? 6 : new Date().getDay() - 1, // 0=å‘¨ä¸€, 6=å‘¨æ—¥
            currentWeight: 84.5,
            
            // ä»Šæ—¥å®æ—¶æ•°æ®
            todayBurned: 0,
            todayEaten: 0,
            
            // è®°å½•åˆ—è¡¨
            exerciseLogs: [],
            foodLogs: [],

            // å†å²è¶‹åŠ¿æ•°æ® (æ¨¡æ‹Ÿ14å¤©)
            historyLabels: Array.from({length:14}, (_,i) => `${i+1}æ—¥`),
            weightHistory: [85.0, 84.9, 84.8, 84.9, 84.7, 84.6, 84.5, 84.4, 84.3, 84.5, 84.4, 84.3, 84.4, 84.5],
            burnHistory: [400, 500, 0, 300, 300, 600, 0, 450, 520, 50, 320, 300, 600, 0], // æœ€å0æ˜¯ä»Šå¤©åŠ¨æ€å¡«
            intakeHistory: [1800, 1900, 2000, 1700, 1850, 1900, 2100, 1800, 1750, 1900, 1800, 1850, 1950, 0], // æœ€å0æ˜¯ä»Šå¤©
            deficitHistory: [] // è®¡ç®—ç”Ÿæˆ
        };

        // é™æ€è®¡åˆ’æ–‡æ¡ˆ
        const weeklyPlans = [
            { day: "å‘¨ä¸€", type: "å†²åˆº", plan: ["å“‘é“ƒå¾ªç¯ x4ç»„", "è·‘æ­¥ 30åˆ†é’Ÿ"], menu: "æ—©é¤: ç‡•éº¦+2è›‹ | åˆ: é¸¡èƒ¸è‚‰+å°‘ç±³é¥­ | æ™š: ç‰ç±³+æ²™æ‹‰" },
            { day: "å‘¨äºŒ", type: "ä¼‘æ¯", plan: ["å…¨èº«æ‹‰ä¼¸ 20åˆ†é’Ÿ", "æ•£æ­¥ (å¯é€‰)"], menu: "å…¨å¤©æ§ç¢³ï¼Œå¤šåƒè”¬èœï¼Œæ™šé¤ä¸åƒä¸»é£Ÿ" },
            { day: "å‘¨ä¸‰", type: "å¡‘å½¢", plan: ["ä¸Šè‚¢å“‘é“ƒ x4ç»„", "å¹³æ¿æ”¯æ’‘ x3ç»„"], menu: "æ­£å¸¸æ§å¡é¤ï¼Œç»ƒåè¡¥å……è›‹ç™½æ£’" },
            { day: "å‘¨å››", type: "ä¿ƒç¾", plan: ["å“‘é“ƒæ·±è¹² x4ç»„", "ç®­æ­¥è¹² x4ç»„"], menu: "åˆé¤ç¨å¾®å¤šåƒä¸€ç‚¹ç‰›è‚‰ï¼Œæ™šé¤æ¸…æ·¡" },
            { day: "å‘¨äº”", type: "å¾ªç¯", plan: ["å…¨èº«å¾ªç¯ x3ç»„", "æ³¢æ¯”è·³ x20ä¸ª"], menu: "åŒå‘¨ä¸€ï¼Œå¤‡æˆ˜å‘¨æœ«å·¥ä½œ" },
            { day: "å‘¨å…­", type: "å·¥ä½œ", plan: ["é©¬æœ¯æ•™å­¦ (é«˜æ¶ˆè€—)", "ç¡å‰æ‹‰ä¼¸"], menu: "æ—©é¤åƒé¥±ï¼Œåˆé¤åƒå¥½ï¼Œæ™šé¤å°‘åƒ" },
            { day: "å‘¨æ—¥", type: "å·¥ä½œ", plan: ["é©¬æˆ¿æŠ¤ç† (ä¸­æ¶ˆè€—)", "æ ¸å¿ƒè®­ç»ƒ"], menu: "æ—©é¤åƒé¥±ï¼Œåˆé¤åƒå¥½ï¼Œæ™šé¤å°‘åƒ" }
        ];

        // ============ åˆå§‹åŒ– ============
        document.addEventListener('DOMContentLoaded', () => {
            initDateScrollers();
            renderStaticPlans(state.todayIndex);
            updateDashboard();
            initAllCharts();
        });

        // ============ æ ¸å¿ƒé€»è¾‘ ============

        // 1. æ›´æ–°é¦–é¡µä»ªè¡¨ç›˜
        function updateDashboard() {
            // ä½“é‡è¿›åº¦
            const lost = CONFIG.startWeight - state.currentWeight;
            const totalGoal = CONFIG.startWeight - CONFIG.targetWeight;
            const progress = Math.min(100, Math.max(0, (lost / totalGoal) * 100));
            document.getElementById('weightProgressBar').style.width = `${progress}%`;
            document.getElementById('weightDiff').innerText = `åˆå§‹è‡³ä»Š ${lost > 0 ? '-' : '+'}${Math.abs(lost).toFixed(1)} kg`;

            // æ¶ˆè€—åœ†ç¯é€»è¾‘
            // å…¬å¼: ç›®æ ‡æ¶ˆè€—çƒ­é‡ - åŸºç¡€ä»£è°¢ (è¿™é‡Œç®€åŒ–ä¸º: è¿åŠ¨ç›®æ ‡ - å·²è¿åŠ¨)
            // å‡è®¾ "éœ€è¦æ¶ˆè€—" æŒ‡çš„æ˜¯ é¢å¤–çš„è¿åŠ¨æ¶ˆè€—ç›®æ ‡
            const burnGoal = CONFIG.dailyTargetBurn; 
            const burnVal = state.todayBurned;
            const burnRemain = Math.max(0, burnGoal - burnVal);
            const burnPct = Math.min(100, Math.round((burnVal / burnGoal) * 100));
            
            drawRing('burnRing', burnPct);
            document.getElementById('burnPercent').innerText = `${burnPct}%`;
            document.getElementById('burnNeeded').innerText = burnRemain;

            // æ‘„å…¥åœ†ç¯é€»è¾‘
            // å…¬å¼: é™é¢ - å·²æ‘„å…¥ = è¿˜éœ€(è¿˜èƒ½)æ‘„å…¥
            const eatLimit = CONFIG.dailyTargetIntake;
            const eatVal = state.todayEaten;
            const eatRemain = eatLimit - eatVal; // å…è®¸è´Ÿæ•°
            const eatPct = Math.min(100, Math.round((eatVal / eatLimit) * 100));

            drawRing('eatRing', eatPct);
            document.getElementById('eatPercent').innerText = `${eatPct}%`;
            
            const eatEl = document.getElementById('eatRemaining');
            eatEl.innerText = eatRemain >= 0 ? eatRemain : `è¶…æ ‡ ${Math.abs(eatRemain)}`;
            eatEl.style.color = eatRemain >= 0 ? 'var(--text-main)' : 'var(--danger)';
            
            // æ›´æ–°å›¾è¡¨ä»Šæ—¥æ•°æ®
            state.burnHistory[state.burnHistory.length-1] = burnVal;
            state.intakeHistory[state.intakeHistory.length-1] = eatVal;
            updateChartData();
        }

        // 2. æ¸²æŸ“é™æ€è®¡åˆ’
        function renderStaticPlans(dayIdx) {
            const info = weeklyPlans[dayIdx];
            
            // è®­ç»ƒé¡µç½®é¡¶
            document.getElementById('trainPlanTitle').innerText = `${info.day}è®¡åˆ’`;
            document.getElementById('trainPlanType').innerText = info.type;
            const trainHtml = info.plan.map(item => `
                <div class="static-plan-item">
                    <div class="dot"></div>
                    <div class="static-text">${item}</div>
                </div>
            `).join('');
            document.getElementById('trainPlanList').innerHTML = trainHtml;

            // ç¼ºå£é¡µç½®é¡¶
            document.getElementById('dietRecommendList').innerHTML = info.menu;
        }

        // 3. æ‰“å¡é€»è¾‘ (é€šç”¨)
        function addExercise(name, duration, cal) {
            const id = Date.now();
            state.todayBurned += cal;
            state.exerciseLogs.unshift({ id, name, val: `${duration}åˆ†é’Ÿ`, cal });
            renderLogs('exerciseLogList', state.exerciseLogs, 'removeExercise');
            updateDashboard();
            showToast(`å·²è®°å½•: ${name} +${cal}kcal`);
        }

        function removeExercise(id) {
            const idx = state.exerciseLogs.findIndex(i => i.id == id);
            if (idx > -1) {
                state.todayBurned -= state.exerciseLogs[idx].cal;
                state.exerciseLogs.splice(idx, 1);
                renderLogs('exerciseLogList', state.exerciseLogs, 'removeExercise');
                updateDashboard();
            }
        }

        function addFood(name, cal, unit) {
            const id = Date.now();
            state.todayEaten += cal;
            state.foodLogs.unshift({ id, name, val: unit, cal });
            renderLogs('foodLogList', state.foodLogs, 'removeFood');
            updateDashboard();
            showToast(`å·²æ‘„å…¥: ${name} +${cal}kcal`);
        }

        function removeFood(id) {
            const idx = state.foodLogs.findIndex(i => i.id == id);
            if (idx > -1) {
                state.todayEaten -= state.foodLogs[idx].cal;
                state.foodLogs.splice(idx, 1);
                renderLogs('foodLogList', state.foodLogs, 'removeFood');
                updateDashboard();
            }
        }

        function renderLogs(containerId, list, removeFnName) {
            const container = document.getElementById(containerId);
            if (list.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:var(--text-sub); font-size:12px; padding:10px;">æš‚æ— è®°å½•</p>`;
                return;
            }
            container.innerHTML = list.map(item => `
                <div class="log-item">
                    <div class="log-info">
                        <h5>${item.name} (${item.val})</h5>
                        <span>${item.cal} kcal</span>
                    </div>
                    <button class="del-btn" onclick="${removeFnName}(${item.id})">æ’¤é”€</button>
                </div>
            `).join('');
        }

        // ============ äº¤äº’åŠ¨æ•ˆ ============
        function switchTab(tabId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            const idx = tabId === 'home' ? 0 : tabId === 'train' ? 1 : 2;
            document.querySelectorAll('.tab-item')[idx].classList.add('active');

            // åˆ‡æ¢Tabæ—¶é‡æ–°è°ƒæ•´å›¾è¡¨æ»šåŠ¨ä½ç½®
            if(tabId === 'train') scrollChartToEnd('burnChartWrapper');
            if(tabId === 'diet') {
                scrollChartToEnd('intakeChartWrapper');
                scrollChartToEnd('deficitChartWrapper');
            }
        }

        function toggleAccordion(header) {
            const item = header.parentElement;
            const content = header.nextElementSibling;
            
            // å…³é—­å…¶ä»– (å¯é€‰ï¼Œè¿™é‡Œåšæˆäº’æ–¥)
            // document.querySelectorAll('.accordion-item').forEach(i => {
            //     if(i !== item) {
            //         i.classList.remove('expanded');
            //         i.querySelector('.accordion-content').style.maxHeight = null;
            //     }
            // });

            item.classList.toggle('expanded');
            if (item.classList.contains('expanded')) {
                content.style.maxHeight = content.scrollHeight + "px";
            } else {
                content.style.maxHeight = null;
            }
        }

        function initDateScrollers() {
            const days = ['å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­','å‘¨æ—¥'];
            const html = days.map((d, i) => 
                `<div class="date-chip ${i === state.todayIndex ? 'active' : ''}" onclick="changeDay(this, ${i})">${d}</div>`
            ).join('');
            
            document.getElementById('trainDateScroller').innerHTML = html;
            document.getElementById('dietDateScroller').innerHTML = html;
        }

        function changeDay(el, idx) {
            // ä»…è§†è§‰åˆ‡æ¢ï¼Œå®é™…é€»è¾‘åœ¨æ¼”ç¤ºç‰ˆä¸åˆ‡æ¢æ•°æ®ä¸Šä¸‹æ–‡
            el.parentElement.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            renderStaticPlans(idx);
        }

        function drawRing(id, percent) {
            const circle = document.getElementById(id);
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // ============ å›¾è¡¨é€»è¾‘ (Chart.js) ============
        let charts = {};

        function initAllCharts() {
            createScrollableChart('weightChart', 'weightChartWrapper', state.weightHistory, '#007AFF', 80);
            createScrollableChart('burnChart', 'burnChartWrapper', state.burnHistory, '#FF9500', 0);
            createScrollableChart('intakeChart', 'intakeChartWrapper', state.intakeHistory, '#34C759', 1500);
            
            // è®¡ç®—ç¼ºå£ = æ¶ˆè€—(åŸºç¡€+è¿åŠ¨) - æ‘„å…¥
            // è¿™é‡Œç®€å•æ¨¡æ‹Ÿ åŸºç¡€=1800
            const deficitData = state.intakeHistory.map((intake, i) => {
                const burn = state.burnHistory[i] || 0;
                return (1800 + burn) - intake;
            });
            createScrollableChart('deficitChart', 'deficitChartWrapper', deficitData, '#AF52DE', 0);
        }

        function createScrollableChart(canvasId, wrapperId, data, color, suggestedMin) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // åŠ¨æ€å®½åº¦ï¼šæ¯æ¡æ•°æ®ç»™ 50pxï¼Œæœ€å°ä¸€å±å®½
            const pointWidth = 50;
            const totalWidth = Math.max(window.innerWidth - 40, data.length * pointWidth);
            ctx.canvas.width = totalWidth;
            ctx.canvas.height = 220;

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: state.historyLabels,
                    datasets: [{
                        data: data,
                        borderColor: color,
                        backgroundColor: color + '20', // hex + alpha
                        borderWidth: 3,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: color,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: false, // å…³é—­å“åº”å¼ä»¥ä¾¿æˆ‘ä»¬æ§åˆ¶width
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    layout: { padding: { left: 10, right: 20, top: 20, bottom: 10 } },
                    scales: {
                        y: { 
                            display: true, 
                            suggestedMin: suggestedMin,
                            grid: { borderDash: [4, 4], color: '#E5E5EA' } 
                        },
                        x: { grid: { display: false } }
                    }
                }
            });

            scrollChartToEnd(wrapperId);
        }

        function scrollChartToEnd(wrapperId) {
            setTimeout(() => {
                const wrapper = document.getElementById(wrapperId);
                wrapper.scrollLeft = wrapper.scrollWidth;
            }, 100);
        }

        function updateChartData() {
            // ç®€å•æ›´æ–°æ‰€æœ‰å›¾è¡¨çš„æœ€åä¸€ä¸ªç‚¹
            if(charts['burnChart']) {
                charts['burnChart'].data.datasets[0].data = state.burnHistory;
                charts['burnChart'].update();
            }
            if(charts['intakeChart']) {
                charts['intakeChart'].data.datasets[0].data = state.intakeHistory;
                charts['intakeChart'].update();
            }
            if(charts['deficitChart']) {
                 const deficitData = state.intakeHistory.map((intake, i) => {
                    const burn = state.burnHistory[i] || 0;
                    return (1800 + burn) - intake;
                });
                charts['deficitChart'].data.datasets[0].data = deficitData;
                charts['deficitChart'].update();
            }
        }

    </script>
</body>
</html>